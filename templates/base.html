<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BMO Bank</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<!-- Customer Care Chat Modal -->
<div class="modal fade" id="chatModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">ğŸ’¬ Customer Care Chat</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-0" style="height: 500px;">
        <iframe src="{{ url_for('customer_care') }}" style="width:100%;height:100%;border:0;"></iframe>
      </div>
    </div>
  </div>
</div>
<body class="bg-light">
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="/">
        <img src="https://cdn-icons-png.flaticon.com/512/3135/3135706.png" alt="logo" width="40" height="40" class="me-2">
        <strong>BMO Bank</strong>
      </a>
      {% if user %}
        <div class="dropdown">
          <button class="btn btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
            My Account
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="/">ğŸ¦ Dashboard (USD)</a></li>
            
            <!-- List all accounts dynamically with Transfer links -->
            {% if user.accounts %}
              {% for acc in user.accounts %}
                <li>
                  <a class="dropdown-item" href="/history/{{ acc.id }}">ğŸ“œ {{ acc.name }} (USD)</a>
                </li>
                <li>
                  <a class="dropdown-item" href="/transfer/{{ acc.id }}">ğŸ’¸ Transfer from {{ acc.name }}</a>
                </li>
              {% endfor %}
            {% endif %}
            
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="/logout">ğŸšª Logout</a></li>
          </ul>
        </div>
      {% else %}
        <div>
          <a href="/signup" class="btn btn-success me-2">Signup</a>
          <a href="/login" class="btn btn-light">Login</a>
        </div>
      {% endif %}
    </div>
  </nav>
  
  <div class="container mt-5">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            {{ messages[0]|safe }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        <script>
          setTimeout(() => {
            let alert = document.querySelector('.alert');
            if(alert){ alert.classList.remove('show'); alert.classList.add('hide'); }
          }, 4000);
        </script>
      {% endif %}
    {% endwith %}
    
    {% block content %}{% endblock %}
  </div>
</body>
</html>
